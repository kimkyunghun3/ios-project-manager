# ğŸ“‘ í”„ë¡œì íŠ¸ ê´€ë¦¬ ì•±
> í”„ë¡œì íŠ¸ ê¸°ê°„: 2022-07-04 ~ 2022-07-29
> 
> íŒ€ì›: [malrang](https://github.com/malrang-malrang), [Eddy](https://github.com/kimkyunghun3)
> 
> ë¦¬ë·°ì–´: [Lucas](https://github.com/innocarpe)

## ğŸ” í”„ë¡œì íŠ¸ ì†Œê°œ
**ì—…ë¬´ë“¤ì˜ ìŠ¤ì¼€ì¤„ì„ ê´€ë¦¬í•˜ê³  ì‹¶ë‹¤êµ¬ìš”?? í”„ë¡œì íŠ¸ ë§¤ë‹ˆì €ë¡œ ê´€ë¦¬í•˜ì„¸ìš” ğŸ¤—**

## ğŸ“º í”„ë¡œì íŠ¸ ì‹¤í–‰í™”ë©´

| history ë‚´ì—­ | ëª©ë¡ ì¶”ê°€ | 
|:---:|:---:|
|<img src = "https://i.imgur.com/QcORGZo.gif" width="500" height="300" >|<img src = "https://i.imgur.com/CLIzu1y.gif" width="500" height="300">|

| ëª©ë¡ ì´ë™ | ëª©ë¡ í¸ì§‘ |
|:---:|:---:|
|<img src = "https://i.imgur.com/283CtT5.gif" width="500" height="300">|<img src = "https://i.imgur.com/8Y82R1L.gif" width="500" height="300">|

| ëª©ë¡ ì‚­ì œ | local Notification  | 
|:---:|:---:|
|<img src = "https://i.imgur.com/3jdaT0H.gif" width="500" height="300">|<img src = "https://i.imgur.com/ACd8x9K.gif" width="500" height="300">|


| Realm ì €ì¥ | 
|:---:|
|<img src = "https://i.imgur.com/CA8RWFZ.gif" width="1000" height="300">|

| firebase ë™ê¸°í™” | 
|:---:|
|<img src = "https://i.imgur.com/OCghVZQ.gif" width="1000" height="300">|

## ğŸ‘€ PR
- [STEP 1](https://github.com/yagom-academy/ios-project-manager/pull/119)
- STEP 2
    - [STEP 2-1](https://github.com/yagom-academy/ios-project-manager/pull/127)
    - [STEP 2-2](https://github.com/yagom-academy/ios-project-manager/pull/134)
    - [STEP 2-3](https://github.com/yagom-academy/ios-project-manager/pull/140)
    - [STEP 2-4, 2-5](https://github.com/yagom-academy/ios-project-manager/pull/146)
    - [STEP 2-6, 2-7](https://github.com/yagom-academy/ios-project-manager/pull/150)
- STEP 3
    - [STEP 3-1](https://github.com/yagom-academy/ios-project-manager/pull/152)
    - [STEP 3-2](https://github.com/yagom-academy/ios-project-manager/pull/158)
    - [STEP 3-3](https://github.com/yagom-academy/ios-project-manager/pull/162)
- [STEP 4](https://github.com/yagom-academy/ios-project-manager/pull/170)

## ğŸ›  ê°œë°œí™˜ê²½ ë° ë¼ì´ë¸ŒëŸ¬ë¦¬
[![swift](https://img.shields.io/badge/swift-5.0-orange)]()[![xcode](https://img.shields.io/badge/Xcode-13.0-blue)]()[![Realm](https://img.shields.io/badge/Realm-10.2-brown)]()[![Firebase](https://img.shields.io/badge/Firebase-9.0.0-yellow)]()[![Rxswift](https://img.shields.io/badge/Rxswift-6.5-hotpink)]()

## ğŸ”‘ í‚¤ì›Œë“œ
`Swift Package Manager` ` Realm` `Firebase` `Rxswift` `MVVM` `Popover` `Coordinator Pattern` `LongPressGesture` `Undo, Redo`

## âœ¨ êµ¬í˜„ë‚´ìš©
[STEP 1]
- Swift Package Managerë¥¼ í†µí•´ ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ê´€ë¦¬
- ë¡œì»¬ DBë¡œ Realm, remote DBë¡œ Firebase ì„¤ì¹˜

[STEP 2-1, 2-2]
- TodoList ë„¤ë¹„ê²Œì´ì…˜ ë°” êµ¬í˜„
- MVVM + Rxswiftë¥¼ í™œìš©í•˜ì—¬ TodoList TableView UI êµ¬í˜„
- í•˜ë‚˜ì˜ Viewë¡œ statusì— ë”°ë¼ Tableview êµ¬ë¶„

[STEP 2-3, 2-4, 2-5]
- TodoList ìƒì„±, í¸ì§‘, ì‚­ì œ ê¸°ëŠ¥ êµ¬í˜„
- Popoverë¥¼ í†µí•´ TodoListë¥¼ Todo, Doing, Done ì´ë™

[STEP 2-6, 2-7]
- longPressGestureì‹œ Popoverì°½ì´ ë„ì›Œì§€ë©° ë©”ë‰´ì— ë”°ë¼ ì›í•˜ëŠ” Statusë¡œ ê°€ë„ë¡ êµ¬í˜„
- í• ì¼ ëª©ë¡ ê¸°í•œ ì´ˆê³¼ì‹œ DateLabel(TODO, DOING Statusì—ì„œë§Œ)ì˜ ìƒ‰ìƒ ë³€ê²½ êµ¬í˜„
 
[STEP 3-1, 3-2]
- ë¡œì»¬ ë””ìŠ¤í¬ì¸ Realmë¥¼ í™œìš©í•´ ë°ì´í„°ë¥¼ ì €ì¥, ì‚­ì œ, í¸ì§‘ ê¸°ëŠ¥ êµ¬í˜„
- ë¦¬ëª¨íŠ¸ ë””ìŠ¤í¬ì¸ Firebaseì— ë°ì´í„° ì €ì¥, ì‚­ì œ, í¸ì§‘ ë° ë¡œì»¬ ë””ìŠ¤í¬ì™€ ë™ê¸°í™” ê¸°ëŠ¥ êµ¬í˜„
- ë„¤íŠ¸ì›Œí¬ ì—°ê²° ìœ ë¬´ì— ë”°ë¼ ìœ ì €ì—ê²Œ ì•Œë ¤ì£¼ëŠ” ì™€ì´íŒŒì´ image êµ¬í˜„

[STEP 3-3]
- ë³€ê²½ì‚¬í•­ì„ ë³´ì—¬ì£¼ëŠ” history view êµ¬í˜„

[STEP 4]
- Local notification ìƒì„, ì‚­ì œ, ì—…ë°ì´íŠ¸ ê¸°ëŠ¥ êµ¬í˜„
- undo, redo ê¸°ëŠ¥ êµ¬í˜„

## ğŸ¤” ê³ ë¯¼í•œì , íŠ¸ëŸ¬ë¸” ìŠˆíŒ…

### 1ï¸âƒ£ ë¡œì»¬DB / ì›ê²©DB ë¼ì´ë¸ŒëŸ¬ë¦¬ ì„ íƒ

âœ… **ì„ íƒí•œ ë¼ì´ë¸ŒëŸ¬ë¦¬**
ë¡œì»¬DBëŠ” `Realm`/ ì›ê²©DBëŠ” `Firebase Realtime Database` ë¡œ ê²°ì •í–ˆë‹¤.

**ğŸ¤” í•˜ìœ„ ë²„ì „ í˜¸í™˜ì„±ì—ëŠ” ë¬¸ì œê°€ ì—†ëŠ”ê°€?**
âœ… ì„ íƒí•œ `Firebase Realtime Database`ëŠ” iOS 10, `Realm`ëŠ” iOS 8 ë¶€í„° ì§€ì›í•œë‹¤.
[iOS ë° IPad ì‚¬ìš©í˜„í™©](https://developer.apple.com/kr/support/app-store/)ì„ ë³´ê²Œë˜ë©´ IPadë¥¼ ì‚¬ìš©í•˜ëŠ” ìœ ì €ì˜ 90% ì´ìƒì´ iOS 14 ë²„ì „ ì´ìƒì„ ì‚¬ìš©í•˜ëŠ”ê²ƒì„ ì•Œìˆ˜ ìˆì—ˆê³  í•˜ìœ„ ë²„ì „ í˜¸í™˜ì„±ì— ë¬¸ì œê°€ ì—†ë‹¤ê³  íŒë‹¨í–ˆë‹¤.

<img src = "https://i.imgur.com/YXe7g8z.png" width = "200">

**ğŸ¤” ì•ˆì •ì ìœ¼ë¡œ ìš´ìš© ê°€ëŠ¥í•œê°€?**
âœ… Realmì€ MongoDBì˜ ì„œë¹„ìŠ¤ë¡œ ëŒ€ì¤‘ì ìœ¼ë¡œ ì‚¬ìš©ë˜ì–´ ê²€ì¦ëœ ê¸°ìˆ ì´ê¸° ë•Œë¬¸ì— ì•ˆì •ì ì¸ ìš´ìš©ì´ ê°€ëŠ¥í• ê²ƒìœ¼ë¡œ íŒë‹¨í•œë‹¤.

ë˜í•œ Realmì€ ê¸°ì¡´ì˜ ì •í˜•í™”ëœ ë°ì´í„° ë² ì´ìŠ¤ì™€ ë‹¤ë¥´ê²Œ NoSQL ë°ì´í„°ë² ì´ìŠ¤ë¥¼ ì§€í–¥í•˜ë©° Realm APIë¥¼ ì‚¬ìš©í•´ ì¢€ë” ì§ê´€ì ì¸ ì‚¬ìš©ì´ ê°€ëŠ¥í•˜ë©° ë°ì´í„° ì²˜ë¦¬ ì†ë„ê°€ í–¥ìƒëœ ì¥ì ì´ ìˆë‹¤.
* Realmê³¼ ë‹¤ë¥¸ DataBaseì˜ ì„±ëŠ¥ë¹„êµ ê·¸ë˜í”„

<img src = "https://i.imgur.com/wps0N9Q.png" width = "300"><img src = "https://i.imgur.com/5RBdKIF.png" width = "370">

[ìë£Œ ì¶œì²˜](https://hesam-kamalan.medium.com/database-benchmark-realm-vs-snappydb-f4b89711f424)

âœ… FirebaseëŠ” Googleì˜ ì„œë¹„ìŠ¤ë¡œ Realmê³¼ ê°™ì´ ëŒ€ì¤‘ì ìœ¼ë¡œ ì‚¬ìš©ë˜ì–´ ê²€ì¦ëœ ê¸°ìˆ ì´ê¸° ë•Œë¬¸ì— ì•ˆì •ì ì¸ ìš´ìš©ì´ ê°€ëŠ¥í•  ê²ƒìœ¼ë¡œ íŒë‹¨í•œë‹¤.

### 2ï¸âƒ£ Coordinator Pattern
í”„ë¡œì íŠ¸ë¥¼ ì§„í–‰í•˜ë©´ì„œ í™”ë©´ì „í™˜ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆë‹¤.
ListViewì—ì„œ DetailViewë¡œ í™”ë©´ì „í™˜ì„ í• ë•Œì˜ íŠ¸ë¦¬ê±°ëŠ” 2ê°œ ì´ë©° ê° íŠ¸ë¦¬ê±°ëŠ” tableViewì˜ Cellì„ Tapí–ˆì„ë•Œ, ë„¤ë¹„ê²Œì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ ìš°ì¸¡ì˜ "+" ë²„íŠ¼ì„ Tap í–ˆì„ë•Œ DetailViewë¡œ í™”ë©´ì „í™˜ì„ í•˜ê²Œ ëœë‹¤.

êµ¬ì¡°ìƒ tableViewë¥¼ ì†Œìœ í•˜ê³  ìˆëŠ” ListViewì™€ ë„¤ë¹„ê²Œì´ì…˜ ì»¨íŠ¸ë¡¤ëŸ¬ë¥¼ ì†Œìœ í•˜ëŠ” TodoListViewController ëª¨ë‘ í™”ë©´ì „í™˜ì„ í•˜ëŠ” ê¸°ëŠ¥ì´ í•„ìš”í•˜ê²Œë˜ë©° ê°™ì€ ê¸°ëŠ¥ì´ì§€ë§Œ ê°ê° êµ¬í˜„í•´ì£¼ì–´ì•¼í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

ì´ë¥¼ í•´ê²°í•˜ê¸°ìœ„í•´ Coordinator Patternì„ í™œìš©í•˜ì—¬ í™”ë©´ì „í™˜ ì—­í• ì„ ë‹´ë‹¹í•˜ëŠ” AppCoordinatorë¥¼ êµ¬í˜„í•˜ì˜€ê³  êµ¬ì¡°ëŠ” ì•„ë˜ì˜ ê·¸ë¦¼ê³¼ ê°™ë‹¤.

<img src="https://i.imgur.com/hoZY3g2.png" width="400">
<img src="https://i.imgur.com/VJDXp4y.png" width="401">

ListView, TodoListViewControllerëŠ” í™”ë©´ì „í™˜ì„ í•„ìš”ë¡œ í•˜ê²Œë˜ë©´ AppCoordinatorì—ê²Œ í™”ë©´ì„ ì „í™˜í•´ë‹¬ë¼ê³  ìš”ì²­í•˜ëŠ” ë°©ì‹ìœ¼ë¡œ í™”ë©´ì„ ì „í™˜í• ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•˜ì˜€.

AppCoordinatorë¥¼ êµ¬í˜„í•¨ìœ¼ë¡œì¨ í™”ë©´ì„ ì „í™˜í•˜ëŠ” ê¸°ëŠ¥ì˜ ì¤‘ë³µì½”ë“œ ë¬¸ì œë¥¼ ê°œì„ í• ìˆ˜ ìˆì—ˆê³  ì¶”ìƒí™”ë¥¼ í†µí•´ ViewëŠ” í™”ë©´ì„ ì–´ë–»ê²Œ ë³´ì—¬ì¤„ê²ƒì¸ì§€ë§Œì„ ì •ì˜í• ìˆ˜ìˆê²Œ ë˜ì—ˆë‹¤.

### 3ï¸âƒ£ Reactive longPress ControlEvent êµ¬í˜„
tableViewì˜ Cellì„ longPress í• ê²½ìš° Popover viewë¥¼ ë³´ì—¬ì£¼ëŠ” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸°ìœ„í•´ tableViewì— longPress Gestureë¥¼ ì¶”ê°€ í•´ì£¼ì–´ì•¼ í–ˆë‹¤.

RxSwift ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì‚¬ìš©í•˜ê³  ìˆê¸°ì— RxGesture ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€ í•˜ì—¬ longPress ControlEvent ë¥¼ ì‚¬ìš©í• ìˆ˜ë„ ìˆì—ˆì§€ë§Œ RxGestureë¼ì´ë¸ŒëŸ¬ë¦¬ì˜ longPress Gestureë¥¼ ì‚¬ìš©í•˜ë”ë¼ë„ longPressí•œ Cellì˜ ë°ì´í„°ë¥¼ í™œìš©í•˜ê¸° ìœ„í•´ì„œëŠ” ì„¸ë¶€ ë¡œì§ì„ êµ¬í˜„í•´ì£¼ì–´ì•¼í•˜ëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.

ê·¸ë ‡ë‹¤ë©´ RxGesture ë¼ì´ë¸ŒëŸ¬ë¦¬ë¥¼ ì¶”ê°€í•˜ëŠ”ê²ƒì´ ì•„ë‹Œ ì´ë²ˆ í”„ë¡œì íŠ¸ì—ì„œ ì¢€ë” ì‰½ê²Œ í™œìš©í•  ìˆ˜ ìˆë„ë¡ Reactiveë¥¼ extension í•˜ì—¬ longPress ControlEventë¥¼ êµ¬í˜„í•˜ì˜€ë‹¤.

```swift
extension Reactive where Base: UITableView {
    func modelLongPressed<T>(_ modelType: T.Type) -> ControlEvent<(UITableViewCell, T)> {
        let longPressGesture = UILongPressGestureRecognizer(target: nil, action: nil)
        
        base.addGestureRecognizer(longPressGesture)
        let source = longPressGesture.rx.event
            .filter { $0.state == .began }
            .map { base.indexPathForRow(at: $0.location(in: base)) }
            .flatMap { [weak tableView = base as UITableView] indexPath -> Observable<(UITableViewCell, T)> in
                guard let tableView = tableView,
                      let indexPath = indexPath,
                      let cell = tableView.cellForRow(at: indexPath) else { return Observable.empty() }
                return Observable.zip(
                    Observable.just(cell),
                    Observable.just(try tableView.rx.model(at: indexPath))
                )
            }
        return ControlEvent(events: source)
    }
}
```
RxSwift tableView.rxì˜ modelselected, modelDeletedì™€ ìœ ì‚¬í•˜ê²Œ ì‚¬ìš©í• ìˆ˜ ìˆë„ë¡ ë„¤ì´ë°ì— modelì„ í‚¤ì›Œë“œë¥¼ ì¶”ê°€í•´ì£¼ì—ˆë‹¤.

tableViewì˜ modelLongPressed ì´ë²¤íŠ¸ê°€ ê°ì§€ë ê²½ìš° ì–´ë–¤ìœ„ì¹˜ì˜ Cellì¸ì§€ ì•Œìˆ˜ìˆë„ë¡ í•˜ê³  ì–´ë–¤ ë°ì´í„°ë¥¼ ê°€ì§€ê³  ìˆëŠ”ì§€ ì•Œìˆ˜ ìˆë„ë¡ ì™¸ë¶€ì— ì „ë‹¬ í•˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.

í•˜ì§€ë§Œ ìœ„ì™€ê°™ì´ êµ¬í˜„í–ˆì„ë•Œ ê¸°ì¡´ì— êµ¬í˜„í•´ ë‘ì—ˆë˜ tableViewì˜ tap ì´ë²¤íŠ¸ê°€ ê°ì§€ë˜ì§€ ì•ŠëŠ” ë¬¸ì œê°€ ë°œìƒí–ˆë‹¤.
tap, modelLongPressed ë‘˜ì¤‘ ì–´ë–¤ ì´ë²¤íŠ¸ë¥¼ ê°ì§€í• ì§€ ì•Œìˆ˜ ì—†ê²Œ ëœê²ƒì´ë‹¤.
ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ ControlEventì— ìš°ì„ ìˆœìœ„ë¥¼ ì„¤ì •í• ìˆ˜ ìˆì„ê¹Œ? ê³ ë¯¼í•˜ì˜€ê³  modelLongPressed ì´ë²¤íŠ¸ ë‚´ë¶€ì˜ UILongPressGestureRecognizer ì†ì„±ì¤‘ minimumPressDuration ì„ í™œìš©í•˜ì—¬ ë¬¸ì œë¥¼ í•´ê²°í–ˆë‹¤.

```swift
 let longPressGesture: UILongPressGestureRecognizer = {
            let gesture = UILongPressGestureRecognizer(target: nil, action: nil)
            gesture.minimumPressDuration = 0.5
            return gesture
        }()
```
0.5ì´ˆ ì´ìƒ longPress í–ˆì„ ê²½ìš°ì— ì¸ì‹ë˜ë„ë¡ ìˆ˜ì •í•˜ì˜€ë‹¤.

### 4ï¸âƒ£ DataManagerë¥¼ í™œìš©í•˜ì—¬ ì¶”ìƒí™” êµ¬í˜„
DataManagerì—ì„œ Local Database, Remote Databaseë¥¼ ê´€ë¦¬í•  ìˆ˜ ìˆë„ë¡ êµ¬í˜„í•œë‹¤.

<img src ="https://i.imgur.com/Lm8A4EW.png" width="350">

DataManagerë¥¼ ì‚¬ìš©í•˜ë©´ ìƒˆë¡œìš´ Databaseê°€ ì˜¤ë”ë¼ë„ ì´ê³³ì—ì„œ ê´€ë¦¬í•˜ê³  CRUDë¥¼ ì‹¤í–‰ì‹œí‚¤ë©´ ë˜ê¸° ë•Œë¬¸ì— ìµœì†Œí•œì˜ ë³€ê²½ìœ¼ë¡œ êµ¬í˜„ì´ ê°€ëŠ¥í•´ì§„ë‹¤.

í”„í† ë¡œì½œì„ í†µí•´ í•„ìš” ê¸°ëŠ¥ë“¤ì„ ì •ì˜í•´ë‘ê³  êµ¬í˜„ì„ ë‚´ë¶€ì—ì„œ í•´ì£¼ëŠ” ë°©ì‹ìœ¼ë¡œ ì¶”ìƒí™”í–ˆë‹¤.
```swift
protocol DatabaseManagerProtocol {
    var todoListBehaviorRelay: BehaviorRelay<[Todo]> { get }
    var historyBehaviorRelay: BehaviorRelay<[History]> { get }

    func create(todoData: Todo)
    func update(selectedTodo: Todo)
    func delete(todoID: UUID)
    func isConnected() -> Observable<Bool>
    func isHistoryEmpty() -> Observable<Bool>
    func deleteHistory()
}

final class DatabaseManager: DatabaseManagerProtocol {
        // ì‹¤ì œ êµ¬í˜„ì´ ì´ë£¨ì–´ì§€ëŠ” ê³³
    let todoListBehaviorRelay = BehaviorRelay<[Todo]>(value: [])
    let historyBehaviorRelay = BehaviorRelay<[History]>(value: [])

    private let realm = RealmDatabase()
    private let firebase = FirebaseDatabase()
}
```

### 5ï¸âƒ£ ë¡œì»¬ ë””ìŠ¤í¬ì™€ ë¦¬ëª¨íŠ¸ ë””ìŠ¤í¬ ë™ê¸°í™” ê¸°ëŠ¥ êµ¬í˜„
ë¡œì»¬ ë””ìŠ¤í¬ì— ì €ì¥ëœ ë°ì´í„°ë¥¼ ë¦¬ëª¨íŠ¸ ë””ìŠ¤í¬ì— ë™ê¸°í™” í•˜ëŠ” ê¸°ëŠ¥ì„ ì¶”ê°€í•˜ê¸° ìœ„í•´ì„œ ê·œì¹™ì„ ì„¸ì›Œì•¼ í•œë‹¤ê³  ìƒê°í–ˆë‹¤.
ë¡œì§ì„ ì˜ëª» êµ¬í˜„í•˜ê±°ë‚˜ ë™ê¸°í™” ë°©ì‹ì´ ì ì ˆí•˜ì§€ ì•ŠëŠ” ê²½ìš° ë¡œì»¬ ë””ìŠ¤í¬ í˜¹ì€ ë¦¬ëª¨íŠ¸ ë””ìŠ¤í¬ì˜ ë°ì´í„°ê°€ ì†Œì‹¤ë  ìœ„í—˜ì´ ìˆì„ê²ƒì´ë¼ ìƒê°í–ˆë‹¤.

ë°ì´í„°ê°€ ì†Œì‹¤ë˜ì§€ ì•Šë„ë¡ ë™ê¸°í™” ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸°ìœ„í•´ ë¡œì»¬ ë””ìŠ¤í¬, ë¦¬ëª¨íŠ¸ ë””ìŠ¤í¬ ë‘˜ ì¤‘ ì–´ë–¤ ê²ƒì„ í”„ë¡œì íŠ¸ì˜ ë©”ì¸ ë””ìŠ¤í¬ë¡œ ì‚¬ìš©í•  ê²ƒì¸ì§€ ê³ ë¯¼í•˜ê³  ë„¤íŠ¸ì›Œí¬ê°€ ì—°ê²°ë˜ì§€ ì•ŠëŠ” ìƒí™©ì„ ê³ ë ¤í•˜ì—¬ ë¡œì»¬ë””ìŠ¤í¬ë¥¼ ë©”ì¸ ë””ìŠ¤í¬ë¡œ ì‚¬ìš©í•˜ë„ë¡ í–ˆë‹¤.

ë¡œì»¬ ë””ìŠ¤í¬ì˜ ë°ì´í„°ë¥¼ ë¦¬ëª¨íŠ¸ ë””ìŠ¤í¬ì™€ ë™ê¸°í™” ê¸°ëŠ¥ì„ ìˆ˜í–‰í•˜ëŠ” ì‹œì ì€ ì•„ë˜ì™€ ê°™ë‹¤.
- ì•± ì‹¤í–‰ ì‹œ ë¦¬ëª¨íŠ¸ ë””ìŠ¤í¬ì™€ ë™ê¸°í™”í•˜ë„ë¡ í•œë‹¤.
- ì•± ì‹¤í–‰ ì¤‘ì— ë¡œì»¬ ë””ìŠ¤í¬ CRUD ê¸°ëŠ¥ ë™ì‘ ì‹œ ë¦¬ëª¨íŠ¸ ë””ìŠ¤í¬ì™€ ì‹¤ì‹œê°„ ë™ê¸°í™”í•˜ë„ë¡ í•œë‹¤.

ë™ê¸°í™” ê¸°ëŠ¥ì€ ì•„ë˜ì™€ ê°™ì€ ë°©ì‹ìœ¼ë¡œ ì´ë£¨ì–´ì§„ë‹¤.
RealmDatabaseì—ì„œ ë°ì´í„°ì˜ ë³€í™”ê°€ ê°ì§€ë˜ë©´ ì´ë¥¼ ê°ì§€í•˜ê³  ìˆë˜ dataBehaviorRelayì˜ ìŠ¤íŠ¸ë¦¼ì„ í™œìš©í•´ì„œ ì´ë¥¼ êµ¬ë…í•˜ê³  ìˆëŠ” DatabaseManagerì—ì„œ ê°ê°ì˜ CRUDTypeì— ë”°ë¼ firebaseì—ì„œ ë™ê¸°í™”í•˜ë„ë¡ ê¸°ëŠ¥ì„ êµ¬í˜„í–ˆë‹¤.

```swift
// RealDatabase.swift
enum CRUDType {
    case create(at: Todo)
    case update(at: Todo)
    case delete(at: UUID)
    case read(at: [Todo])
}

let dataBehaviorRelay = BehaviorRelay<CRUDType>(value: .read(at: []))

func create(todoData: Todo) {
    try? self.realm?.write { [weak self] in
        self?.realm?.add(todoData.todoDTO())
    }
    self.dataBehaviorRelay.accept(.create(at: todoData))
}
```

```swift
// DatabaseManager.swift
private func bind() {
    self.realm.dataBehaviorRelay.subscribe(onNext: { CRUDType in
        switch CRUDType {
        case .create(at: let todoData):
            self.firebase.create(todoData: todoData)
        case .update(at: let selectedTodoData):
            self.firebase.update(selectedTodo: selectedTodoData)
        case .delete(at: let selectedTodoData):
            self.firebase.delete(todoID: selectedTodoData)
        case .read(at: let todoDataList):
            self.firebase.sync(todoData: todoDataList)
            self.todoListBehaviorRelay.accept(todoDataList)
        }
    })
    .disposed(by: self.disposeBag)
}

```
### 6ï¸âƒ£ Local Notification
NotificationManagerì—ì„œ local notification ê´€ë ¨ ë¡œì§ì„ ëª¨ë‘ ê´€ë¦¬í•˜ê²Œ ë˜ì—ˆë‹¤.

ë§ˆê°ê¸°í•œ ë‹¹ì¼ ì˜¤ì „ 9ì‹œì— ì‚¬ìš©ìì—ê²Œ Notficiationì´ ì „ë‹¬ë˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.
```swift
// NotificationManager.swift
func setNotification(todoData: Todo) {
    // ìƒëµ
    
    var todoDateComponent = Calendar.current.dateComponents([.year, .month, .day], from: todoData.date)
    todoDateComponent.hour = 9

    let trigger = UNCalendarNotificationTrigger(dateMatching: todoDateComponent, repeats: false)
    let request = UNNotificationRequest(
        identifier: todoData.identifier.uuidString,
        content: content,
        trigger: trigger
    )
    self.notificationCenter.add(request)
}

```

ê·¸ë¦¬ê³  ì‚­ì œëŠ” identiferë¥¼ í™•ì¸í•˜ì—¬ í•´ë‹¹ notificationì„ ì œê±°í• ìˆ˜ ìˆë„ë¡ êµ¬í˜„í–ˆë‹¤.
```swift
func deleteNotification(todoIdentifier: String) {
    self.notificationCenter.removePendingNotificationRequests(withIdentifiers: [todoIdentifier])
}
```

ì—…ë°ì´íŠ¸ëŠ” done statusì—ì„œëŠ” ìš¸ë¦¬ì§€ ì•Šì•„ì•¼ í•˜ë¯€ë¡œ doneì´ë©´ notificationì„ ì§€ìš°ê³  ê·¸ê²Œ ì•„ë‹ˆë¼ë©´ í•´ë‹¹í•˜ëŠ” notificationë¥¼ ì—…ë°ì´íŠ¸í•´ì£¼ë„ë¡ í•œë‹¤.
```swift
func updateNotification(todoData: Todo) {
    guard todoData.todoListItemStatus != .done else {
        return deleteNotification(todoIdentifier: todoData.identifier.uuidString)
    }
    self.setNotification(todoData: todoData)
}
```

ì‚¬ìš© ë˜ëŠ” ì‹œì ì€ ìœ ì €ê°€ ëª©ë¡ì„ ë§Œë“¤ ë•Œ, listViewì¸ ì²« í™”ë©´ ì‹œì ì— ê¶Œí•œ íšë“ì„ ìœ„í•´ ì‚¬ìš©í–ˆìœ¼ë©° ì‹¤ì œ NotificationëŠ” background ì§„ì… ì‹œ ë˜ë„ë¡ ì„¤ê³„í–ˆë‹¤.


### 7ï¸âƒ£ Undo, Redo ê¸°ëŠ¥
Swiftì— ê¸°ë³¸ì ìœ¼ë¡œ ì œê³µë˜ëŠ” UndoManagerë¥¼ ì‚¬ìš©í• ìˆ˜ë„ ìˆì—ˆì§€ë§Œ ì§ì ‘ ê¸°ëŠ¥ì„ êµ¬í˜„í•´ë³´ê³ ì‹¶ì—ˆë‹¤.
íŒ€ì›ê³¼ ìƒì˜ ëì— êµ¬í˜„í•˜ê³ ì í–ˆë˜ Undo, Redo ê¸°ëŠ¥ì€ ë‹¤ìŒê³¼ ê°™ë‹¤.
1. History ë‚´ì—­ì´ ì¡´ì¬í• ê²½ìš° HistoryButton, UndoButtonì´ í™œì„±í™” ëœë‹¤. ë‚´ì—­ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¹„í™œì„±í™” ëœë‹¤.
2. Undoë‚´ì—­ì´ ì¡´ì¬í• ê²½ìš° RedoButtonì´ í™œì„±í™” ëœë‹¤. ë‚´ì—­ì´ ì¡´ì¬í•˜ì§€ ì•ŠëŠ”ë‹¤ë©´ ë¹„í™œì„±í™” ëœë‹¤.
3. ì•±ì„ ì¬ì‹¤í–‰í• ê²½ìš° ê¸°ì¡´ì˜ Historyë‚´ì—­ì´ ëª¨ë‘ ì œê±°ëœë‹¤.

ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê¸°ìœ„í•´ undo, redoì˜ ë²„íŠ¼ì„ ê°ì§€í•˜ëŠ” relayë¥¼ ë§Œë“¤ê³  ì–´ë–¤ë°ì´í„°ë¥¼ undo, redo í•´ì•¼ í•˜ëŠ”ì§€ ì•Œê¸°ìœ„í•´ undoDataStack, redoDataStackì„ ë§Œë“¤ì–´ë‘ì—ˆë‹¤.

```swift
final class UndoRedoManager {
    let undoRelay = PublishRelay<Void>()
    let redoRelay = PublishRelay<Void>()

    private var undoDataStack: [History] = []
    private var redoDataStack: [History] = []
}
```

undo Buttonì„ Tapí•  ê²½ìš° undoDataStackì˜ ë§ˆì§€ë§‰ ë°ì´í„°ë¥¼ redoDataStackì— ë„£ì–´ì£¼ê³  ë˜ëŒë¦¬ê¸°(Undo)ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œ ë’¤ ë§ˆì§€ë§‰ ë°ì´í„°ë¥¼ ì œê±°í•œë‹¤.

redo Buttonì„ Tap í• ê²½ìš° redoDataStackì˜ ë§ˆì§€ë§‰ ë°ì´í„°ë¥¼ í™•ì¸í•´ Redo(ë˜ëŒë¦¬ê¸° ì·¨ì†Œ)ê¸°ëŠ¥ì„ ìˆ˜í–‰í•œ ë’¤ ë§ˆì§€ë§‰ ë‚´ì—­ì„ ì œê±°í•œë‹¤.

undo, redoì˜ í–‰ë™ì€ historyì˜ ì‚­ì œ, ì´ë™, ì¶”ê°€, í¸ì§‘ ë“± ë‚´ì—­ì— ë”°ë¼ ê°ê° ë‹¤ë¥´ê²Œ ì •ì˜ë‚´ë ¤ì•¼ í•˜ë¯€ë¡œ switch êµ¬ë¬¸ì„ ì‚¬ìš©í•´ ëŒ€ì‘í•´ì£¼ì—ˆë‹¤.

ê·¸ë¦¬ê³  historyì— ê°’ì´ ë³€í•˜ëŠ” ê²ƒì„ ê°ì§€í•˜ëŠ” databaseì— ìˆëŠ” historyBehaviorRelayë¥¼ í†µí•´ ê°’ì˜ ë³€í™”ê°€ ìƒê¸¸ ë•Œë§ˆë‹¤ undoDataStackì— ëŒ€ì…í•´ì£¼ì—ˆë‹¤.

```swift
self.undoRelay
    .subscribe(onNext: { [weak self] _ in
        guard let lastHistory = self?.undoDataStack.removeLast() else { return }
        self?.undoRedoActionAble.undoTapEvent(history: lastHistory)
        self?.redoDataStack.append(lastHistory)
    })
    .disposed(by: self.disposeBag)

self.redoRelay
    .subscribe(onNext: { [weak self] _ in
        guard let lastHistory = self?.redoDataStack.removeLast() else { return }
        self?.undoRedoActionAble.redoTapEvent(history: lastHistory)
    })
    .disposed(by: self.disposeBag)
```

ê·¸ë¦¬ê³  redoButton í™œì„±í™” ê´€ë ¨í•´ì„œ isRedoEmpty() ë©”ì„œë“œë¥¼ í†µí•´ undoRelay, redoRelayë¥¼ í†µí•©ì ìœ¼ë¡œ ê´€ë¦¬í•˜ì—¬ ë§Œì•½ redoDataStackì— ì•„ë¬´ê²ƒë„ ì—†ë‹¤ë©´ falseë¥¼ ì˜µì €ë²„ë¡œ ë³´ë‚´ê³  ê·¸ê²Œ ì•„ë‹ˆë©´ trueë¥¼ ë³´ë‚´ë„ë¡ êµ¬í˜„í–ˆë‹¤.
```swift
func isRedoEmpty() -> Observable<Bool> {
    return Observable.create { observer in
        let _ = Observable.of(self.undoRelay, self.redoRelay)
            .merge()
            .subscribe(onNext: { [weak self] _ in
                if self?.redoDataStack.count == 0 {
                    observer.onNext(false)
                } else {
                    observer.onNext(true)
                }
            })
        return Disposables.create()
    }
}
```

ì´ë¥¼ ViewModelì—ì„œ ê²°ê³¼ì ìœ¼ë¡œ ì²˜ë¦¬í•  ìˆ˜ ìˆë„ë¡ í•˜ì—¬ ì—­í• ê³¼ ì±…ì„ë¶„ë¦¬ë¥¼ í–ˆë‹¤.

ê²°ë¡ ì ìœ¼ë¡œ viewModelì—ì„œ Driverë¡œ ë³€ê²½í•˜ê³  ì´ë¥¼ Viewì—ì„œ ì‚¬ìš©í•˜ì—¬ ë³€í™”ì— ê°ì§€í•˜ì—¬ active, inactiveê°€ ë˜ë„ë¡ êµ¬í˜„í–ˆë‹¤.

```swift
// TodoListViewModel.swift
self.isRedoEmpty = self.undoRedoManager.isRedoEmpty()
    .asDriver(onErrorJustReturn: false)

// TodoListViewController.swift
self.viewModel.isRedoEmpty
    .drive(onNext: { [weak self] isRedo in
        self?.isRedoButtonActive(isRedoEmpty: isRedo)
    })
    .disposed(by: self.disposeBag)
```
